<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form with Bootstrap</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .form-container {
      max-width: 500px;
      margin: auto;
      margin-top: 50px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background-color: #fff;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container">
    <div class="form-container">
      <h4 class="text-center mb-4">Form Submission to Google Sheet</h4>
      <form id="submit-to-google-sheet">
        <div class="form-group">
          <label for="name">Name:</label>
          <input
            class="form-control"
            type="text"
            name="name"
            id="name"
            placeholder="Name"
            required
          />
        </div>
        
        <div class="form-group">
          <label for="department">Department:</label>
          <select class="form-control" name="department" id="department" required>
            <option value="" disabled selected hidden>Choose...</option>
            <option value="AWPO">AWPO</option>
            <option value="Fighter">Fighter</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary btn-block">Submit</button>
      </form>
    </div>
  </div>
<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzbgiGymS4xOpdii4yY9jWTXKbb0x51jon5CQUDK_BjNjAgFyhnIrVywqGniZGkXu3wDw/exec";
  const form = document.getElementById("submit-to-google-sheet");

  // Load saved values from localStorage
  window.addEventListener("load", () => {
    if (localStorage.getItem("name")) {
      document.getElementById("name").value = localStorage.getItem("name");
    }
    if (localStorage.getItem("department")) {
      document.getElementById("department").value = localStorage.getItem("department");
    }
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    // Save to localStorage
    localStorage.setItem("name", formData.get("name"));
    localStorage.setItem("department", formData.get("department"));

    // Add timestamp in Singapore local format (dd/mm/yyyy hh:mm)
    const now = new Date();
    const options = {
      timeZone: "Asia/Singapore",
      day: "2-digit",
      month: "2-digit",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    };
    const timestamp = new Intl.DateTimeFormat("en-GB", options).format(now).replace(",", "");
    formData.append("timestamp", timestamp);

    fetch(scriptURL, { method: "POST", body: formData })
      .then((response) => {
        Swal.fire({
          title: "Success!",
          text: "Your form has been submitted successfully.",
          icon: "success",
          confirmButtonText: "OK"
        }).then(() => {
          // Disable fields after success
          document.getElementById("name").setAttribute("readonly", true);
          document.getElementById("department").setAttribute("disabled", true);
        });
      })
      .catch((error) => {
        Swal.fire({
          title: "Error!",
          text: "Something went wrong. Please try again!",
          icon: "error",
          confirmButtonText: "OK"
        });
      });
  });
</script>
</body>
</html>